set (GENERATION_SOURCE "${CMAKE_CURRENT_SOURCE_DIR}/universe_preprocessor.c")
set (GENERATION_OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/Generated/universe_preprocessor.c")

add_custom_command (
        OUTPUT "${GENERATION_OUTPUT}"
        DEPENDS "${GENERATION_SOURCE}"
        COMMENT "Generate universe_preprocessor_main code from re2c template."
        COMMAND re2c "${GENERATION_SOURCE}" -o "${GENERATION_OUTPUT}")

register_concrete (universe_preprocessor_main)
concrete_include (PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}")
concrete_highlight_direct ("${GENERATION_SOURCE}")
concrete_sources_direct ("${GENERATION_OUTPUT}")
concrete_require (SCOPE PUBLIC ABSTRACT error file_system memory CONCRETE_INTERFACE container)

set (KAN_UNIVERSE_PREPROCESSOR_QUERY_INITIAL_SLOTS "4" CACHE STRING
        "Initial capacity of scanned query arrays in states.")
set (KAN_UNIVERSE_PREPROCESSOR_TARGET_PATH_MAX_LENGTH "64" CACHE STRING
        "Max length of query target field path (for example, indexed value or interval field path).")
set (KAN_UNIVERSE_PREPROCESSOR_OUTPUT_BUFFER_SIZE "4096" CACHE STRING "Size of an IO buffer for file output.")
set (KAN_UNIVERSE_PREPROCESSOR_STATE_PATH_MAX_LENGTH "128" CACHE STRING
        "Max length of path to state struct pointer. State is a struct where autogenerated queries are stored.")

concrete_compile_definitions (
        PRIVATE
        KAN_UNIVERSE_PREPROCESSOR_QUERY_INITIAL_SLOTS=${KAN_UNIVERSE_PREPROCESSOR_QUERY_INITIAL_SLOTS}
        KAN_UNIVERSE_PREPROCESSOR_TARGET_PATH_MAX_LENGTH=${KAN_UNIVERSE_PREPROCESSOR_TARGET_PATH_MAX_LENGTH}
        KAN_UNIVERSE_PREPROCESSOR_OUTPUT_BUFFER_SIZE=${KAN_UNIVERSE_PREPROCESSOR_OUTPUT_BUFFER_SIZE}
        KAN_UNIVERSE_PREPROCESSOR_STATE_PATH_MAX_LENGTH=${KAN_UNIVERSE_PREPROCESSOR_STATE_PATH_MAX_LENGTH})
